{{ $knowledgeHub := where .Site.RegularPages "Section" "knowledge-hub" }}
{{ $currentLang := .Site.Language.Lang }}

{{/* Initialize counters */}}
{{ $blogCount := 0 }}
{{ $webinarCount := 0 }}
{{ $solutionBriefCount := 0 }}
{{ $whitepaperCount := 0 }}

{{/* Count items by checking their file path */}}
{{ range $knowledgeHub }}
  {{ $path := .File.Path }}
  {{ if (findRE "knowledge-hub/blog/" $path) }}
    {{ $blogCount = add $blogCount 1 }}
  {{ else if (findRE "knowledge-hub/webinar/" $path) }}
    {{ $webinarCount = add $webinarCount 1 }}
  {{ else if (findRE "knowledge-hub/solution-brief/" $path) }}
    {{ $solutionBriefCount = add $solutionBriefCount 1 }}
  {{ else if (findRE "knowledge-hub/whitepaper/" $path) }}
    {{ $whitepaperCount = add $whitepaperCount 1 }}
  {{ end }}
{{ end }}


<section class="tf-buttons-container-center">
  {{/* Category filter buttons */}}
  <div class="tf-buttons-container">
    <button class="active" data-category="all">
      All <span class="filter-number">({{ len $knowledgeHub }})</span>
    </button>
    <button data-category="blog">
      Blog / Tech Updates <span class="filter-number">({{ $blogCount }})</span>
    </button>
    <button data-category="webinar">
      Webinars <span class="filter-number">({{ $webinarCount }})</span>
    </button>
    <button data-category="solution-brief">
      Solution Briefs
      <span class="filter-number">({{ $solutionBriefCount }})</span>
    </button>
    <button data-category="whitepaper">
      Whitepapers <span class="filter-number">({{ $whitepaperCount }})</span>
    </button>
  </div>
  {{/* Language buttons */}}
  <div class="line">
    <div class="tf-buttons-container">
      {{/* Current language button (active) */}}
      <button class="text active" style="cursor: default;" title="{{ .Site.Language.LanguageName }}">
        <img
          src="/img/flags/{{ $currentLang }}.svg"
          alt="{{ .Site.Language.LanguageName }} flag"
          style="width: 20px; height: auto; margin-right: 8px; vertical-align: middle;"
        />
        {{ .Site.Language.LanguageName }}&nbsp;
        <span class="filter-number">({{ len $knowledgeHub }})</span>
      </button>

      {{/* Other languages */}}
      {{ range .Site.Home.Translations }}
          <a href="{{ with .GetPage "knowledge-hub" }}{{ .Permalink }}{{ end }}"
            style="text-decoration: none;" 
            title="{{ .Language.LanguageName }}">
            <button class="text">
              <img
                src="/img/flags/{{ .Lang }}.svg"
                alt="{{ .Language.LanguageName }} flag"
                style="width: 20px; height: auto; margin-right: 8px; vertical-align: middle;"
              />
              {{ .Language.LanguageName }}&nbsp;
              <span class="filter-number">({{ len (where .Site.RegularPages "Section" "knowledge-hub") }})</span>
            </button>
          </a>
      {{ end }}
    </div>
  </div>

  <div class="tf-items-container">
    {{ range $knowledgeHub.ByPublishDate.Reverse }}
      {{ $path := .File.Path }}
      {{ $category := "unknown" }}
      {{ if (findRE "knowledge-hub/blog/" $path) }}
        {{ $category = "blog" }}
      {{ else if (findRE "knowledge-hub/webinar/" $path) }}
        {{ $category = "webinar" }}
      {{ else if (findRE "knowledge-hub/solution-brief/" $path) }}
        {{ $category = "solution-brief" }}
      {{ else if (findRE "knowledge-hub/whitepaper/" $path) }}
        {{ $category = "whitepaper" }}
      {{ end }}
      <div
        class="content-container tf-filter-item tf-item show-item"
        data-category="{{ $category }}"
      >
        {{ .Render "li-latest" }}
      </div>
    {{ end }}
  </div>
</section>

<style>
  /* Override default tf-filter-item display */
  .tf-filter-item {
    display: block !important;
  }

  .tf-filter-item.hidden {
    display: none !important;
  }

  /* Ensure buttons have pointer cursor */
  .tf-buttons-container button {
    cursor: pointer;
    transition: all 0.2s ease-out;
  }

  /* Style adjustments for language buttons */
  .tf-buttons-container a {
    text-decoration: none;
  }

  .tf-buttons-container button:hover {
    border-color: var(--button-color);
  }

  .tf-buttons-container button.text {
    display: inline-flex;
    align-items: center;
  }
</style>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    const filterButtons = document.querySelectorAll(
      ".tf-buttons-container button[data-category]",
    );
    const contentItems = document.querySelectorAll(".tf-filter-item");

    filterButtons.forEach((button) => {
      button.addEventListener("click", function () {
        // Remove active class from all category buttons
        filterButtons.forEach((btn) => btn.classList.remove("active"));

        // Add active class to clicked button
        this.classList.add("active");

        // Get selected category
        const selectedCategory = this.getAttribute("data-category");

        // Show/hide content items
        contentItems.forEach((item) => {
          const itemCategory = item.getAttribute("data-category");

          if (selectedCategory === "all" || itemCategory === selectedCategory) {
            item.classList.remove("hidden");
            item.classList.add("show-item");
          } else {
            item.classList.add("hidden");
            item.classList.remove("show-item");
          }
        });
      });
    });
  });
</script>
