{{/* Get content from top-level sections */}}
{{ $blogPages := where .Site.RegularPages "Section" "blog" }}
{{ $techUpdatePages := where .Site.RegularPages "Section" "tech-update" }}
{{ $webinarPages := where .Site.RegularPages "Section" "webinar" }}
{{ $solutionBriefPages := where .Site.RegularPages "Section" "solution-brief" }}
{{ $whitepaperPages := where .Site.RegularPages "Section" "whitepaper" }}

{{/* Combine all content */}}
{{ $allContent := slice }}
{{ $allContent = $allContent | append $blogPages }}
{{ $allContent = $allContent | append $techUpdatePages }}
{{ $allContent = $allContent | append $webinarPages }}
{{ $allContent = $allContent | append $solutionBriefPages }}
{{ $allContent = $allContent | append $whitepaperPages }}

{{ $currentLang := .Site.Language.Lang }}

{{/* Use the actual counts from sections */}}
{{ $blogCount := len $blogPages }}
{{ $techUpdateCount := len $techUpdatePages }}
{{ $webinarCount := len $webinarPages }}
{{ $solutionBriefCount := len $solutionBriefPages }}
{{ $whitepaperCount := len $whitepaperPages }}


<section class="tf-buttons-container-center">
  {{/* Category filter buttons */}}
  <div class="tf-buttons-container">
    <button class="active" data-category="all">
      {{ T "filter.all" }} <span class="filter-number">({{ len $allContent }})</span>
    </button>
    <button data-category="blog">
      {{ T "filter.blog" }} <span class="filter-number">({{ $blogCount }})</span>
    </button>
    <button data-category="tech-update">
      {{ T "filter.tech_updates" }} <span class="filter-number">({{ $techUpdateCount }})</span>
    </button>
    <button data-category="webinar">
      {{ T "filter.webinars" }} <span class="filter-number">({{ $webinarCount }})</span>
    </button>
    <button data-category="solution-brief">
      {{ T "filter.solution_briefs" }}
      <span class="filter-number">({{ $solutionBriefCount }})</span>
    </button>
    <button data-category="whitepaper">
      {{ T "filter.whitepapers" }} <span class="filter-number">({{ $whitepaperCount }})</span>
    </button>
  </div>
  {{/* Language buttons */}}
  <div class="line">
    <div class="tf-buttons-container">
      {{/* Current language button (active) */}}
      <button
        class="text active"
        style="cursor: default;"
        title="{{ .Site.Language.LanguageName }}"
      >
        <img
          src="/img/flags/{{ $currentLang }}.svg"
          alt="{{ .Site.Language.LanguageName }} flag"
          style="width: 20px; height: auto; margin-right: 8px; vertical-align: middle;"
        />
        {{ .Site.Language.LanguageName }}&nbsp;
        <span class="filter-number">({{ len $allContent }})</span>
      </button>

      {{/* Other languages */}}
      {{ range .Site.Home.Translations }}
        <a
          href="{{ with .GetPage "knowledge-hub" }}{{ .Permalink }}{{ end }}"
          style="text-decoration: none;"
          title="{{ .Language.LanguageName }}"
        >
          <button class="text">
            <img
              src="/img/flags/{{ .Lang }}.svg"
              alt="{{ .Language.LanguageName }} flag"
              style="width: 20px; height: auto; margin-right: 8px; vertical-align: middle;"
            />
            {{ .Language.LanguageName }}&nbsp;
            <span class="filter-number"
              >({{ len (where .Site.RegularPages "Section" "blog") |
                add (len (where .Site.RegularPages "Section" "tech-update")) |
                add (len (where .Site.RegularPages "Section" "webinar")) |
                add (len (where .Site.RegularPages "Section" "solution-brief")) |
                add (len (where .Site.RegularPages "Section" "whitepaper"))
              }})</span
            >
          </button>
        </a>
      {{ end }}
    </div>
  </div>

  <div class="tf-items-container">
    {{ range $allContent.ByPublishDate.Reverse }}
      {{ $section := .Section }}
      {{ $category := "unknown" }}
      {{ if eq $section "blog" }}
        {{ $category = "blog" }}
      {{ else if eq $section "tech-update" }}
        {{ $category = "tech-update" }}
      {{ else if eq $section "webinar" }}
        {{ $category = "webinar" }}
      {{ else if eq $section "solution-brief" }}
        {{ $category = "solution-brief" }}
      {{ else if eq $section "whitepaper" }}
        {{ $category = "whitepaper" }}
      {{ end }}
      <div
        class="content-container tf-filter-item tf-item show-item"
        data-category="{{ $category }}"
      >
        {{ .Render "li-latest" }}
      </div>
    {{ end }}
  </div>
</section>

<style>
  /* Override default tf-filter-item display */
  .tf-filter-item {
    display: block !important;
  }

  .tf-filter-item.hidden {
    display: none !important;
  }

  /* Ensure buttons have pointer cursor */
  .tf-buttons-container button {
    cursor: pointer;
    transition: all 0.2s ease-out;
  }

  /* Style adjustments for language buttons */
  .tf-buttons-container a {
    text-decoration: none;
  }

  .tf-buttons-container button:hover {
    border-color: var(--button-color);
  }

  .tf-buttons-container button.text {
    display: inline-flex;
    align-items: center;
  }
</style>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    const filterButtons = document.querySelectorAll(
      ".tf-buttons-container button[data-category]",
    );
    const contentItems = document.querySelectorAll(".tf-filter-item");

    filterButtons.forEach((button) => {
      button.addEventListener("click", function () {
        // Remove active class from all category buttons
        filterButtons.forEach((btn) => btn.classList.remove("active"));

        // Add active class to clicked button
        this.classList.add("active");

        // Get selected category
        const selectedCategory = this.getAttribute("data-category");

        // Show/hide content items
        contentItems.forEach((item) => {
          const itemCategory = item.getAttribute("data-category");

          if (selectedCategory === "all" || itemCategory === selectedCategory) {
            item.classList.remove("hidden");
            item.classList.add("show-item");
          } else {
            item.classList.add("hidden");
            item.classList.remove("show-item");
          }
        });
      });
    });
  });
</script>
