<header id="navbar" class="site-header">
  <div class="site-header-wrapper">
    <div class="site-header-logo">
      <a href="/">
        <img
          src="/img/logos/safespring_logotype_blue_svg.svg"
          width="140"
          height="30"
          alt="Safespring logotype"
        />
      </a>
    </div>
    <nav class="site-header-nav">
      <!-- Desktop menu (hidden on mobile) -->
      <div class="desktop-menu">
        <ul id="menu" class="site-header-links">
          <li>
            <a
              id="main-menu-link-platform"
              style="padding-bottom: 30px; margin-bottom: -30px"
              href="{{ relref . "services" }}"
              >{{ T "menu.platform" }}</a
            >
          </li>
          <li>
            <a id="main-menu-link-1" href="{{ relref . "price" }}"
              >{{ T "menu.price" }}</a
            >
          </li>
          <li>
            <a id="main-menu-link-2" href="{{ relref . "knowledge-hub" }}"
              >{{ T "knowledgehub.news" }}</a
            >
          </li>
          <li>
            <a id="main-menu-link-3" href="{{ relref . "contact" }}"
              >{{ T "menu.contact" }}</a
            >
          </li>
          <li>
            <a
              id="main-menu-link-5"
              href="mailto:hello@safespring.com"
              class="site-header-button-mail"
              onclick="_paq.push(['trackEvent', 'Knapptryck', 'Mailknapp']);"
              >hello@safespring.com</a
            >
          </li>
        </ul>
      </div>
      <!-- Mobile menu button (always visible on mobile) -->
      <div id="mobileMenuBtn" class="mobile-menu-btn" aria-label="Toggle menu">
        <span></span>
        <span></span>
        <span></span>
      </div>
    </nav>
  </div>

  <!-- Desktop megamenu -->
  <div class="megamenu-wrapper desktop-only">
    <div class="megamenu-main-service">
      {{ range (where $.Site.RegularPages "Section"
        "services").ByParam "cardorder"
      }}
        {{ if isset .Params "megamenu" }}{{ .Render "li-megamenu" }}{{ end }}
      {{ end }}
    </div>
    <div class="megamenu-service-card">
      <span class="megamenu-service-card-title-small"
        >{{ T "menu.built_on_safespring" }}</span
      >
      <ul class="megamenu-service-card-list">
        {{ range (where $.Site.RegularPages "Section" "services").ByParam
          "cardorder"
        }}
          {{ if and (not (isset .Params "megamenu")) (isset .Params
            "cardorder")
          }}
            <li>
              <a href="{{ .RelPermalink }}" class="matomo-track"
                >{{ .Params.cardtitle }}</a
              >
            </li>
          {{ end }}
        {{ end }}
      </ul>
    </div>
  </div>

  <!-- Mobile menu wrapper (inside header) -->
  <div class="mobile-menu-wrapper" id="mobileMenuWrapper">
    <!-- Main menu screen -->
    <div class="menu-screen" id="mobileMainMenu">
      <ul>
        <li class="menu-item-featured">
          <a href="#" data-submenu="mobilePlatformSubMenu"
            >{{ T "menu.platform" }}</a
          >
        </li>
        <li class="menu-item-featured">
          <a href="#" data-submenu="mobileNewsSubMenu"
            >{{ T "knowledgehub.news" }}</a
          >
        </li>
        <li class="menu-item-featured">
          <a href="#" data-submenu="mobileAboutSubMenu"
            >{{ T "menu.safespring_about" }}</a
          >
        </li>
        <br />
        <li>
          <a href="{{ relref . "contact" }}">{{ T "menu.contact" }}</a>
        </li>
        <li>
          <a href="{{ relref . "price" }}">{{ T "menu.price" }}</a>
        </li>
        <li>
          <a href="{{ relref . "career" }}"
            >{{ T "menu.safespring_careers" }}</a
          >
        </li>
      </ul>
    </div>

    <!-- Platform submenu -->
    <div class="menu-screen submenu" id="mobilePlatformSubMenu">
      <div class="submenu-header">
        <span class="back-button"
          >&larr;
          <span class="submenu-title">{{ T "menu.platform" }}</span></span
        >
      </div>
      <ul>
        <li class="menu-item-featured">
          <a href="{{ relref . "services/compute" }}"
            >{{ T "menu.platform_compute" }}</a
          >
        </li>
        <li class="menu-item-featured">
          <a href="{{ relref . "services/containerplatform" }}"
            >{{ T "menu.platform_container" }}</a
          >
        </li>
        <li class="menu-item-featured">
          <a href="{{ relref . "services/storage" }}"
            >{{ T "menu.platform_storage" }}</a
          >
        </li>
        <li class="menu-item-featured">
          <a href="{{ relref . "services/backup" }}"
            >{{ T "menu.platform_backup" }}</a
          >
        </li>
        <li>
          <a href="{{ relref . "data-centers" }}"
            >{{ T "menu.safespring_datacenters" }}</a
          >
        </li>
        <li>
          <a href="{{ relref . "documents/acceptable-use-policy" }}"
            >{{ T "menu.acceptable_use_policy" }}</a
          >
        </li>
        <br />
        <p class="submenu-heading">{{ T "menu.solutions_for" }}:</p>
        <li>
          <a href="{{ relref . "services/database-as-a-service" }}"
            >{{ T "menu.platform_database" }}</a
          >
        </li>
        <li>
          <a href="{{ relref . "services/compliant-kubernetes" }}"
            >{{ T "menu.welkin" }}</a
          >
        </li>
        <li>
          <a href="{{ relref . "services/machine-learning" }}"
            >{{ T "menu.platform_ai" }}</a
          >
        </li>
      </ul>
    </div>

    <!-- Knowledge Hub submenu -->
    <div class="menu-screen submenu" id="mobileNewsSubMenu">
      <div class="submenu-header">
        <span class="back-button"
          >&larr;
          <span class="submenu-title">{{ T "knowledgehub.news" }}</span></span
        >
      </div>
      <ul>
        <li class="menu-item-featured">
          <a href="{{ relref . "services/case" }}"
            >{{ T "knowledgehub.use_case" }}</a
          >
        </li>
        <li class="menu-item-featured">
          <a href="{{ relref . "webinar" }}">{{ T "knowledgehub.webcast" }}</a>
        </li>
        <li class="menu-item-featured">
          <a href="{{ relref . "tech-update" }}"
            >{{ T "knowledgehub.tech_update" }}</a
          >
        </li>
        <li class="menu-item-featured">
          <a href="{{ relref . "whitepaper" }}"
            >{{ T "knowledgehub.whitepaper" }}</a
          >
        </li>
        <li class="menu-item-featured">
          <a href="{{ relref . "blog" }}">{{ T "knowledgehub.blog" }}</a>
        </li>
        <li class="menu-item-featured">
          <a href="{{ relref . "solution-brief" }}"
            >{{ T "knowledgehub.solution_brief" }}</a
          >
        </li>
        <li>
          <a href="https://docs.safespring.com">{{ T "menu.docs" }}</a>
        </li>
        <li>
          <a href="{{ relref . "service-catalogue" }}"
            >{{ T "menu.service_catalogue" }}</a
          >
        </li>
        <li>
          <a href="https://status.safespring.com"
            >{{ T "menu.safespring_status" }}</a
          >
        </li>
        <li>
          <a href="{{ relref . "data-centers" }}"
            >{{ T "menu.safespring_datacenters" }}</a
          >
        </li>
      </ul>
    </div>

    <!-- About submenu -->
    <div class="menu-screen submenu" id="mobileAboutSubMenu">
      <div class="submenu-header">
        <span class="back-button"
          >&larr;
          <span class="submenu-title"
            >{{ T "menu.safespring_about" }}</span
          ></span
        >
      </div>
      <ul>
        <li class="menu-item-featured">
          <a href="{{ relref . "about" }}">{{ T "menu.company_in_brief" }}</a>
        </li>
        <li class="menu-item-featured">
          <a href="{{ relref . "data-centers" }}"
            >{{ T "menu.safespring_datacenters" }}</a
          >
        </li>
        <li class="menu-item-featured">
          <a href="{{ relref . "environment" }}"
            >{{ T "menu.safespring_sustainability" }}</a
          >
        </li>
        <li>
          <a href="{{ relref . "corporate-governance" }}"
            >{{ T "menu.corporate_governance" }}</a
          >
        </li>
        <li>
          <a href="{{ relref . "faq" }}">{{ T "menu.safespring_faq" }}</a>
        </li>
        <li>
          <a href="{{ relref . "fr2000" }}">{{ T "menu.certifications" }}</a>
        </li>
      </ul>
    </div>
  </div>
</header>

<style>
  /* Desktop menu styling */
  .desktop-menu {
    display: flex;
    align-items: center;
  }

  /* Mobile menu button - hidden on desktop */
  .mobile-menu-btn {
    display: none;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    background: none;
    border: none;
    cursor: pointer;
    padding: 10px;
    z-index: 1002;
    flex-shrink: 0;
  }

  /* Mobile layout */
  @media only screen and (max-width: 940px) {
    .desktop-menu {
      display: none !important;
    }

    .desktop-only {
      display: none !important;
    }

    .mobile-menu-wrapper {
      display: block !important;
    }

    .mobile-menu-btn {
      display: flex;
    }

    .mobile-menu-btn span {
      display: block;
      width: 33px;
      height: 4px;
      position: relative;
      background: var(--main-color);
      border-radius: 3px;
      z-index: 100;
      transform-origin: 2px 2px;
      transition:
        transform 0.5s cubic-bezier(0.77, 0.2, 0.05, 1),
        background 0.5s cubic-bezier(0.77, 0.2, 0.05, 1),
        opacity 0.55s ease;
    }

    .mobile-menu-btn span:first-child {
      margin-bottom: 6.25px;
    }

    .mobile-menu-btn span:nth-child(2) {
      margin-bottom: 6.25px;
    }

    /* Transform hamburger to X when menu is open */
    .mobile-menu-btn.active span {
      opacity: 1;
      transform: rotate(45deg);
      background: var(--link-color);
    }

    .mobile-menu-btn.active span:nth-child(2) {
      opacity: 0;
      transform: rotate(0deg) scale(0.2, 0.2);
    }

    .mobile-menu-btn.active span:nth-child(3) {
      transform: rotate(-45deg);
    }
  }

  /* Hide mobile menu completely on desktop */
  @media only screen and (min-width: 941px) {
    .mobile-menu-wrapper {
      display: none !important;
    }
  }

  /* Mobile menu styles */
  :root {
    --initialMain: 5px;
    --initialSub: 10px;
    --shiftAmount: 5px;
    --shiftTime: 0.3s;
    --easeFunction: ease;
    --fadeOutTime: 0.15s;
    --fadeInTime: 0.15s;
    --fadeEase: ease-in-out;
    --bgFadeTime: 0.3s;
  }

  .mobile-menu-wrapper {
    position: fixed;
    top: 92px; /* Start below the header bar */
    left: 0;
    width: 100%;
    height: calc(100% - 80px); /* Adjust height to account for header */
    background: transparent;
    color: #195f8c;
    z-index: 1000;
    font-family: var(--hind-font) !important;
    display: none; /* Hidden by default, shown only on mobile */

    opacity: 0;
    visibility: hidden;
    pointer-events: none;
    transition:
      opacity 0.3s ease,
      visibility 0.3s,
      background 0.3s ease;
  }

  .mobile-menu-wrapper.visible {
    background: rgb(250, 254, 254);
    opacity: 1;
    visibility: visible;
    pointer-events: auto;
  }

  /* Menu screens are hidden when menu is closed */
  .mobile-menu-wrapper .menu-screen {
    opacity: 0;
    visibility: hidden;
    pointer-events: none;
    transition:
      opacity var(--fadeEase) var(--fadeOutTime),
      visibility var(--fadeEase) var(--fadeOutTime),
      transform var(--shiftTime) var(--easeFunction);
  }

  .menu-screen {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    overflow-y: auto;
    -webkit-overflow-scrolling: touch;
    padding: 2rem;
  }

  #mobileMainMenu {
    transform: translateX(var(--initialMain));
    transition-delay: 0s;
  }

  .submenu {
    z-index: 1;
    opacity: 0;
    pointer-events: none;
    transform: translateX(var(--initialSub));
    transition-delay: 0s;
  }

  .mobile-menu-wrapper.show-submenu #mobileMainMenu {
    opacity: 0;
    pointer-events: none;
    transform: translateX(calc(var(--initialMain) - var(--shiftAmount)));
    transition-delay: 0s;
  }

  .mobile-menu-wrapper.show-submenu .submenu.active {
    opacity: 1;
    visibility: visible;
    pointer-events: auto;
    transform: translateX(calc(var(--initialSub) - var(--shiftAmount)));
    transition-delay: var(--fadeOutTime);
  }

  .mobile-menu-wrapper.visible:not(.show-submenu) #mobileMainMenu {
    opacity: 1;
    visibility: visible;
    pointer-events: auto;
    transform: translateX(var(--initialMain));
    transition-delay: var(--fadeInTime);
  }

  .mobile-menu-wrapper:not(.show-submenu) .submenu {
    opacity: 0;
    visibility: hidden;
    pointer-events: none;
    transform: translateX(var(--initialSub));
    transition-delay: 0s;
  }

  /* Menu item animations */
  #mobileMainMenu li {
    transform: translateY(-5px);
    opacity: 0;
    transition:
      transform 0.3s ease-out,
      opacity 0.3s ease-out;
  }

  .mobile-menu-wrapper.visible #mobileMainMenu li {
    transform: translateY(0);
    opacity: 1;
  }

  #mobileMainMenu li:nth-child(1) {
    transition-delay: 0.05s;
  }
  #mobileMainMenu li:nth-child(2) {
    transition-delay: 0.1s;
  }
  #mobileMainMenu li:nth-child(3) {
    transition-delay: 0.15s;
  }
  #mobileMainMenu li:nth-child(4) {
    transition-delay: 0.2s;
  }
  #mobileMainMenu li:nth-child(5) {
    transition-delay: 0.25s;
  }
  #mobileMainMenu li:nth-child(6) {
    transition-delay: 0.3s;
  }
  #mobileMainMenu li:nth-child(7) {
    transition-delay: 0.35s;
  }
  #mobileMainMenu li:nth-child(8) {
    transition-delay: 0.4s;
  }
  #mobileMainMenu li:nth-child(9) {
    transition-delay: 0.45s;
  }
  #mobileMainMenu li:nth-child(10) {
    transition-delay: 0.5s;
  }
  #mobileMainMenu li:nth-child(11) {
    transition-delay: 0.55s;
  }

  .menu-screen ul {
    list-style: none;
    margin-top: 0.5rem;
    padding: 0;
    font-family: var(--hind-font);
    margin-bottom: 4rem;
  }

  .menu-screen li {
    padding: 0.2rem 0;
    font-family: var(--hind-font);
  }

  .menu-screen a {
    text-decoration: none;
    font-size: 1rem;
    color: #417da5;
    font-family: var(--hind-font);
    font-weight: normal;
  }

  .menu-item-featured a {
    font-size: 1.6rem;
    font-weight: 600;
    font-style: normal;
    color: #195f8c;
    font-family: var(--hind-font);
  }

  .submenu-header {
    display: flex;
    align-items: center;
    margin-bottom: 1rem;
    font-family: var(--hind-font);
  }

  .back-button {
    font-size: 24px;
    margin-right: 1rem;
    cursor: pointer;
    line-height: 1;
    font-family: var(--hind-font);
    font-weight: normal;
  }

  .submenu-title {
    font-size: 1.6rem;
    font-weight: 600;
    font-family: var(--hind-font);
  }

  .submenu-heading {
    font-size: 1.2rem;
    font-weight: 100;
    margin-bottom: 5px;
    opacity: 0.6;
    color: #195f8c;
    font-family: var(--hind-font);
  }

  /* Prevent body scroll when menu is open */
  body.mobile-menu-open {
    overflow: hidden;
  }
</style>

<script>
  var prevScrollpos = window.pageYOffset;
  window.onscroll = function () {
    var currentScrollPos = window.pageYOffset;
    if (prevScrollpos > currentScrollPos || currentScrollPos < 120) {
      document.getElementById("navbar").style.top = "0px";
    } else {
      document.getElementById("navbar").style.top = "-200px";
    }
    prevScrollpos = currentScrollPos;
  };
</script>
<script>
  let platformLink = document.getElementById("main-menu-link-platform");
  let megaMenuWrapper = document.querySelector(".megamenu-wrapper");
  let hideTimeout;

  platformLink.addEventListener("mouseover", function () {
    clearTimeout(hideTimeout);
    megaMenuWrapper.classList.add("show");
  });

  function handleMouseOut() {
    hideTimeout = setTimeout(function () {
      megaMenuWrapper.classList.remove("show");
    }, 100); // 300ms delay to match the CSS transition
  }

  platformLink.addEventListener("mouseout", handleMouseOut);
  megaMenuWrapper.addEventListener("mouseout", handleMouseOut);
  megaMenuWrapper.addEventListener("mouseover", function () {
    clearTimeout(hideTimeout);
  });
</script>

<script>
  // Mobile menu functionality
  const mobileMenuBtn = document.getElementById("mobileMenuBtn");
  const mobileMenuWrapper = document.getElementById("mobileMenuWrapper");
  const mobileSubmenuLinks = document.querySelectorAll(
    "#mobileMainMenu a[data-submenu]",
  );
  const mobileBackButtons = document.querySelectorAll(
    ".mobile-menu-wrapper .back-button",
  );

  // Function to close the menu
  function closeMobileMenu() {
    mobileMenuWrapper.classList.remove("visible");
    mobileMenuBtn.classList.remove("active");
    document.body.classList.remove("mobile-menu-open");

    // Reset menu state
    mobileMenuWrapper.classList.remove("show-submenu");
    document
      .querySelectorAll(".mobile-menu-wrapper .submenu")
      .forEach((sub) => {
        sub.classList.remove("active");
      });
  }

  // Toggle mobile menu
  if (mobileMenuBtn) {
    mobileMenuBtn.addEventListener("click", function () {
      if (mobileMenuWrapper.classList.contains("visible")) {
        // Closing menu
        closeMobileMenu();
      } else {
        // Opening menu
        mobileMenuWrapper.classList.add("visible");
        mobileMenuBtn.classList.add("active");
        document.body.classList.add("mobile-menu-open");
      }
    });
  }

  // Handle submenu navigation
  mobileSubmenuLinks.forEach((link) => {
    link.addEventListener("click", function (e) {
      e.preventDefault();
      mobileMenuWrapper.classList.add("show-submenu");

      // Remove active from all submenus
      document
        .querySelectorAll(".mobile-menu-wrapper .submenu")
        .forEach((sub) => {
          sub.classList.remove("active");
        });

      // Add active to target submenu
      const targetId = link.getAttribute("data-submenu");
      const targetSubmenu = document.getElementById(targetId);
      if (targetSubmenu) {
        targetSubmenu.classList.add("active");
      }
    });
  });

  // Handle back button
  mobileBackButtons.forEach((btn) => {
    btn.addEventListener("click", function () {
      mobileMenuWrapper.classList.remove("show-submenu");
      document
        .querySelectorAll(".mobile-menu-wrapper .submenu")
        .forEach((sub) => {
          sub.classList.remove("active");
        });
    });
  });

  // Close menu when clicking outside (optional)
  document.addEventListener("click", function (e) {
    if (
      mobileMenuWrapper.classList.contains("visible") &&
      !mobileMenuWrapper.contains(e.target) &&
      !mobileMenuBtn.contains(e.target)
    ) {
      closeMobileMenu();
    }
  });
</script>
