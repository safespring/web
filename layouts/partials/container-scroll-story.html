<style>  
/* SCROLL BOX */
* {
  box-sizing: border-box;
}

h2,
h3 {
  font-family: "Hind", system-ui, -apple-system, Segoe UI, Roboto, Helvetica,
  Arial, sans-serif;
  font-weight: 300;
  margin: 0 0 0.35em;
}

/* === Scrollytelling wrapper (skapar höjd för steg) === */
.scrolly {
  position: relative;
  min-height: calc(var(--stage-gap) * 2.2);
  padding: 15vh 0 0 0;
  --grid-shift: 0px;
  --flow-dot: 8%;
  --flow-x: 88%;
}
.locked-section {
  position: sticky;
  top: 50%;
  transform: translateY(-50%);
}

/* === Sticky kapsel som ligger i mitten === */
.capsule {
  position: relative;
  margin: 0 auto;
  aspect-ratio: 21/9;
  background: var(--card);
  border: 2px solid rgba(25, 95, 140, 0.12);
  border-radius: 60px;
  box-shadow: var(--shadow);
  overflow: hidden;
  display: grid;
  grid-template-columns: 1.05fr 1fr; /* vänster: bild, höger: text */
  gap: var(--gap);
  padding: var(--pad);
}
.capsule::before {
  content: "";
  position: absolute;
  inset: 0;
  border-radius: inherit;
  background-image:
    linear-gradient(90deg, rgba(60, 155, 205, 0.22) 1px, transparent 1px),
    linear-gradient(180deg, rgba(60, 155, 205, 0.22) 1px, transparent 1px),
    radial-gradient(circle at 18% 20%, rgba(60, 155, 205, 0.12), transparent 45%);
  background-size: 46px 46px, 46px 46px, 100% 100%;
  background-position:
    0px calc(var(--grid-shift, 0px) * -1),
    0px calc(var(--grid-shift, 0px) * -1),
    center;
  opacity: 0.28;
  pointer-events: none;
  z-index: 0;
}
.capsule::after {
  content: "";
  position: absolute;
  inset: 0;
  border-radius: inherit;
  background-image:
    radial-gradient(circle at var(--flow-x, 88%) var(--flow-dot, 8%), rgba(250, 105, 15, 0.7) 0 5px, transparent 6px),
    linear-gradient(180deg, rgba(60, 155, 205, 0.0) 0%, rgba(60, 155, 205, 0.35) 45%, rgba(60, 155, 205, 0.0) 70%);
  background-size: 100% 100%, 2px 24px;
  background-repeat: no-repeat, repeat-y;
  background-position: 0 0, var(--flow-x, 88%) calc(var(--grid-shift, 0px) * -1);
  opacity: 0.45;
  pointer-events: none;
  z-index: 0;
}

/* vänster – bildyta */
.figure {
  position: relative;
  border-radius: 0px;
  display: grid;
  place-items: center;
  overflow: hidden;
  z-index: 1;
}
.figure img {
  width: 86%;
  height: auto;
  display: block;
  transition: opacity .25s ease;
  opacity: 1;
}

/* höger – textstack (alla callouts finns här men vi visar 1 åt gången) */
.right {
  position: relative;
  display: grid;
  align-content: center;
  padding-right: clamp(10px, 2vw, 24px);
  z-index: 1;
}
.stack {
  min-height: 56%;
}
.callout {
  position: absolute;
  inset: 0 0 auto 0;
  opacity: 0;
  transform: translateY(12px);
  transition: opacity 0.35s ease, transform 0.35s ease;
}
.callout.active {
  opacity: 1;
  transform: none;
}

.callout h3 {
  color: var(--brand);
  font-size: clamp(22px, 2.3vw, 30px);
}
.callout p {
  margin: 0.35rem 0 0;
  font-size: clamp(15px, 1.1vw + 0.55rem, 18px);
  max-width: 46ch;
}

/* pilar – ligger INUTI kapseln, absolut placerade från vänster mot höger */
.arrow {
  position: absolute;
  left: -85px; /* start approx. inne i bilden */
  max-width: 430px;
  height: 38px;
  pointer-events: none;
  opacity: 0;
  transform: translateX(-8px);
  transition: opacity 0.35s ease, transform 0.35s ease;
}
.arrow.active {
  opacity: 1;
  transform: none;
}
/* vertikalt läge för varje pil */
.arrow[data-id="1"] {
  top: 6px;
}
.arrow[data-id="2"] {
  top: 8px;
}
.arrow[data-id="3"] {
  top: 15px;
}

.callout[data-step="1"] {
  top: 23%;
}
.callout[data-step="2"] {
  top: 43%;
}
.callout[data-step="3"] {
  top: 68%;
}

.arrow svg {
  width: 100%;
  height: 100%;
  display: block;
}
.arrow path {
  stroke: var(--accent);
  stroke-width: 8;
  fill: none;
  stroke-linecap: round;
  stroke-linejoin: round;
}

/* steg-markörer (osynliga boxar som triggar bytena) */
.scrolly .stage {
  height: var(--stage-gap);
}

.stage[data-target="1"] {
  height: 10vh; /* try 35–50vh until it feels right */
}

/* rubrik ovanför */
.lead {
  text-align: center;
  margin: 8vh auto 10vh;
  max-width: 900px;
  padding: 0 20px;
}

/* === STICKY NAV – ligger i scrolly och hamnar alltid ovanför kapseln === */
.nav-box {
  display: flex;
  justify-content: center;
    align-items: center;
}
.nav {
  position: sticky;
  z-index: 50;
  display: flex;
  flex-wrap: wrap;
  align-items: center;
  justify-content: center;
  gap: clamp(10px, 2.2vw, 24px);
  width: fit-content;
  margin: 40px 10px;
  padding: 8px;
  background: rgba(255, 255, 255, 0.85);
  border-radius: 999px;
}
.nav a {
  text-decoration: none;
  color: var(--deep);
  font-weight: 600;
  font-size: clamp(12px,2vw,17px);
  letter-spacing: 0.2px;
  padding: 8px 12px;
  border-radius: 999px;
}

.nav a:hover {
  background: rgba(60, 155, 205, 0.12);
  color: #0d3850;
}

.nav a.active {
  background: rgba(60, 155, 205, 0.12);
  color: #0d3850;
}

/* END - Scroll box */
/* ---------- Mobile optimizations (<=768px) ---------- */
@media (max-width: 768px) {
  .scrolly {
    padding-top: 8vh;
    min-height: auto;
  }

  .locked-section {
    top: 12px;                 /* keep sticky near top */
    transform: none;           /* avoid vertical centering which clips content */
  }

  .capsule {
    grid-template-columns: 1fr; /* stack image over text */
    aspect-ratio: auto;         /* let content decide height */
    border-radius: 28px;
    gap: clamp(10px, 3vw, 14px);
    padding: clamp(12px, 4vw, 18px);
  }
  .capsule::before {
    background-size: 36px 36px, 36px 36px, 100% 100%;
    opacity: 0.18;
  }
  .capsule::after {
    background-size: 100% 100%, 2px 18px;
    opacity: 0.3;
  }

  .nav {
    background: none;
    flex-direction: column;
  }

  .figure {
    order: 1;
  }
  .figure img {
    width: 100%;
  }

  .right {
    order: 2;
    padding-right: 0;
  }

  /* Put callouts into normal flow on mobile so height adapts per step */
  .stack {
    min-height: 0;
  }
  .callout {
    position: static;
    opacity: 1;
    transform: none;
    display: none;             /* only show the active one */
  }
  .callout.active {
    display: block;
  }

  /* Hide decorative arrows on mobile */
  .arrow {
    display: none !important;
  }

  /* Make the sticky nav compact */
  .nav a {
    padding: 12px 20px;
    font-size: 14px;
    background-color: #FFFFFF90;
  }

  /* Give stages more height so IO triggers reliably while capsule is sticky */
  .scrolly .stage {
    height: 60vh;
  }
  .stage[data-target="1"] {
    height: 40vh;
  }
}
</style>
  <div class="scrolly" id="scene">
    <!-- Sticky kapsel (ALLT inuti) -->
    <div class="locked-section">
<div class="nav-box">
      <nav class="nav" aria-label="Sektioner">
        <a href="#control">Control plane</a>
        <a href="#workers">Worker nodes</a>
        <a href="#infra">Infrastructure</a>
      </nav>
      <nav class="nav" aria-label="Sektioner">
        <a href="#price">Skip <i class="fa-solid fa-arrow-down"></i></a>
      </nav>
</div>
      <section class="capsule" aria-label="Kubernetes-kluster">
        <!-- Vänster: Bild -->
        <div class="figure">
          <img src="/img/graphics/safespring-container-platform-image-1.svg" alt="Kubernetes cluster schematic" />
        </div>

        <!-- Höger: Textstack -->
        <div class="right">
          <div class="stack">
            <article class="callout" data-step="1">
              <div class="arrow" data-id="1" aria-hidden="true">
                <svg xmlns="http://www.w3.org/2000/svg" width="82.203" height="52.006" viewBox="0 0 82.203 52.006">                   <g id="Group_47" data-name="Group 47" transform="translate(-830 -9267.724)">                     <line id="Line_12" data-name="Line 12" x2="66.441" transform="translate(835.5 9293.727)" fill="none" stroke="#fa690f" stroke-linecap="round" stroke-width="11"/>                     <line id="Line_13" data-name="Line 13" x2="19.055" y2="18.227" transform="translate(885.371 9275.5)" fill="none" stroke="#fa690f" stroke-linecap="round" stroke-width="11"/>                     <line id="Line_14" data-name="Line 14" y1="18.227" x2="19.055" transform="translate(885.371 9293.727)" fill="none" stroke="#fa690f" stroke-linecap="round" stroke-width="11"/>                   </g>                 </svg>
              </div>
              <p><strong>Safespring’s Kubernetes clusters</strong> provide a managed control plane with different configurations of nodes.</p>
            </article>

            <article class="callout" data-step="2">
              <div class="arrow" data-id="2" aria-hidden="true">
                <svg xmlns="http://www.w3.org/2000/svg" width="82.203" height="52.006" viewBox="0 0 82.203 52.006">                   <g id="Group_47" data-name="Group 47" transform="translate(-830 -9267.724)">                     <line id="Line_12" data-name="Line 12" x2="66.441" transform="translate(835.5 9293.727)" fill="none" stroke="#fa690f" stroke-linecap="round" stroke-width="11"/>                     <line id="Line_13" data-name="Line 13" x2="19.055" y2="18.227" transform="translate(885.371 9275.5)" fill="none" stroke="#fa690f" stroke-linecap="round" stroke-width="11"/>                     <line id="Line_14" data-name="Line 14" y1="18.227" x2="19.055" transform="translate(885.371 9293.727)" fill="none" stroke="#fa690f" stroke-linecap="round" stroke-width="11"/>                   </g>                 </svg>
              </div>
              <p><strong>Worker nodes</strong> are always customer-managed, but each runs as its own virtual machine sized from our flavor catalog. </p>
            </article>

            <article class="callout" data-step="3">
              <div class="arrow" data-id="3" aria-hidden="true">
                <svg xmlns="http://www.w3.org/2000/svg" width="82.203" height="52.006" viewBox="0 0 82.203 52.006">
                  <g id="Group_47" data-name="Group 47" transform="translate(-830 -9267.724)">
                    <line id="Line_12" data-name="Line 12" x2="66.441" transform="translate(835.5 9293.727)" fill="none" stroke="#fa690f" stroke-linecap="round" stroke-width="11"/>
                    <line id="Line_13" data-name="Line 13" x2="19.055" y2="18.227" transform="translate(885.371 9275.5)" fill="none" stroke="#fa690f" stroke-linecap="round" stroke-width="11"/>
                    <line id="Line_14" data-name="Line 14" y1="18.227" x2="19.055" transform="translate(885.371 9293.727)" fill="none" stroke="#fa690f" stroke-linecap="round" stroke-width="11"/>
                  </g>
                </svg>
              </div>
              <p><strong>The infrastructure layer</strong> is managed by Safespring on our own nordic data centers.</p>
            </article>
          </div>
        </div>

        <!-- Pilar (ligger ovanpå och pekar horisontellt från bild mot text) -->
      </section>
    </div>
    <!-- Steg-markörer (osynliga, bara för scroll-logik) -->
    <div id="control" class="anchor"></div>
    <div class="stage" data-target="1"></div>

    <div id="workers" class="anchor"></div>
    <div class="stage" data-target="2"></div>

    <div id="infra" class="anchor"></div>
    <div class="stage" data-target="3"></div>
  </div>
<script>
  (() => {
  /* === SCROLLYTELLING NAV / CAPSULE === */
    const scrollyEl = document.querySelector('#scene');
    if (!scrollyEl) return;
    const stages = [...scrollyEl.querySelectorAll('.stage')];
    const callouts = [...document.querySelectorAll('.callout')];
    const arrows = [...document.querySelectorAll('.arrow')];
    const figureImg = document.querySelector('.figure img');
    const imgMap = {
      1: { src: '/img/graphics/safespring-container-platform-image-1.svg', alt: 'Control plane' },
      2: { src: '/img/graphics/safespring-container-platform-image-2.svg', alt: 'Worker nodes' },
      3: { src: '/img/graphics/safespring-container-platform-image-3.svg', alt: 'Infrastructure' }
    };

    Object.values(imgMap).forEach(({src}) => { const i = new Image(); i.src = src; });

    let lastShift = null;
    function updateGridShift() {
      const max = scrollyEl.offsetHeight - window.innerHeight;
      const current = Math.min(Math.max(window.scrollY - scrollyEl.offsetTop, 0), Math.max(0, max));
      const shift = Math.round(current * 0.28);
      const progress = max > 0 ? current / max : 0;
      const dot = 8 + (progress * 84);
      if (shift !== lastShift) {
        scrollyEl.style.setProperty('--grid-shift', `${shift}px`);
        lastShift = shift;
      }
      scrollyEl.style.setProperty('--flow-dot', `${dot.toFixed(1)}%`);
    }

    let ticking = false;
    function onScroll() {
      if (ticking) return;
      ticking = true;
      requestAnimationFrame(() => {
        updateGridShift();
        ticking = false;
      });
    }

    function activate(step){
      callouts.forEach(el => el.classList.toggle('active', +el.dataset.step === step));
      arrows.forEach(el   => el.classList.toggle('active', +el.dataset.id   === step));

      const next = imgMap[step];
      if (next && figureImg && figureImg.getAttribute('src') !== next.src) {
        figureImg.style.opacity = '0';
        requestAnimationFrame(() => {
          figureImg.src = next.src;
          figureImg.alt = next.alt;
          requestAnimationFrame(() => { figureImg.style.opacity = '1'; });
        });
      }
    }

    const links = {
      1: document.querySelector('.nav a[href="#control"]'),
      2: document.querySelector('.nav a[href="#workers"]'),
      3: document.querySelector('.nav a[href="#infra"]')
    };

    function highlight(step) {
      Object.values(links).forEach(link => link.classList.remove('active'));
      links[step]?.classList.add('active');
    }

    const mobile = window.matchMedia('(max-width: 768px)').matches;
    const io = new IntersectionObserver((entries)=>{
      entries.forEach(entry=>{
        if(entry.isIntersecting){
          const step = +entry.target.dataset.target;
          activate(step);     
          highlight(step);    
        }
      });
    },{
      threshold: mobile ? 0.30 : 0.55,
      rootMargin: mobile ? '-20% 0px -60% 0px' : '0px'
    });

    stages.forEach(s => io.observe(s));
  activate(1); // initialt
  updateGridShift();
  window.addEventListener('scroll', onScroll, { passive: true });
  window.addEventListener('resize', onScroll);

  // Smooth scroll på nav-klick
  document.querySelector('.nav').addEventListener('click', (e)=>{
    const a = e.target.closest('a[href^="#"]');
    if(!a) return;
    e.preventDefault();
    const id = a.getAttribute('href').slice(1);
    const map = { control: 1, workers: 2, infra: 3 };
    const stage = document.querySelector(`.stage[data-target="${map[id]}"]`);
    stage?.scrollIntoView({behavior:'smooth', block:'start'});
  });

  /* === TABS === */
  const root = document.getElementById('tabsBox');
  if (root) {
    const title = root.querySelector('#boxTitle');
    const tabsWrap = root.querySelector('#tabs');
    const tabs = Array.from(root.querySelectorAll('.tab'));
    const panels = Array.from(root.querySelectorAll('.tab-panel'));
    const indicator = root.querySelector('.indicator');
    const stage = root.querySelector('#stage');

    let active = Math.max(0, tabs.findIndex(t => t.classList.contains('is-active')));

    function fixStageHeight(){
      const prev = panels.map(p => p.style.visibility);
      panels.forEach(p => { p.style.visibility = 'hidden'; p.classList.add('is-active'); });
      const tallest = Math.max(...panels.map(p => p.scrollHeight));
      panels.forEach((p,i) => {
        p.style.visibility = prev[i] || '';
        if (i !== active) p.classList.remove('is-active');
      });
      stage.style.height = tallest + 36 + 'px';
    }

    function placeIndicator(i){
      const t = tabs[i];
      const tb = t.getBoundingClientRect();
      const rb = tabsWrap.getBoundingClientRect();
      indicator.style.width = tb.width + 'px';
      indicator.style.transform = `translateX(${tb.left - rb.left}px)`;
    }

    function setStates(i){
      tabs.forEach((t,idx) => {
        const on = idx === i;
        t.classList.toggle('is-active', on);
        t.setAttribute('aria-selected', String(on));
        t.tabIndex = on ? 0 : -1;
      });
      panels.forEach((p,idx) => {
        const on = idx === i;
        p.classList.toggle('is-active', on);
        p.toggleAttribute('aria-hidden', !on);
      });
      title.textContent = tabs[i].textContent.trim();
    }

    function activateTab(i){
      if (i === active) return;
      const run = () => {
        setStates(i);
        placeIndicator(i);
        active = i;
      };
      if (document.startViewTransition &&
          !window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
        document.startViewTransition(run);
    } else {
      run();
    }
  }

  function initTabs(){
    fixStageHeight();
    setStates(active);
    placeIndicator(active);
  }
  window.addEventListener('load', initTabs);
  if (document.readyState === 'complete') initTabs();

  tabs.forEach((t,i) => t.addEventListener('click', () => activateTab(i)));

  tabsWrap.addEventListener('keydown', (e) => {
    const k = e.key;
    let next = active;
    if (k === 'ArrowRight' || k === 'ArrowDown'){ next = (active + 1) % tabs.length; e.preventDefault(); }
    else if (k === 'ArrowLeft' || k === 'ArrowUp'){ next = (active - 1 + tabs.length) % tabs.length; e.preventDefault(); }
    else if (k === 'Home'){ next = 0; e.preventDefault(); }
    else if (k === 'End'){ next = tabs.length - 1; e.preventDefault(); }
    if (next !== active){ tabs[next].focus(); activateTab(next); }
  });

  const ro = new ResizeObserver(() => {
    placeIndicator(active);
    fixStageHeight();
  });
  ro.observe(tabsWrap);
  ro.observe(stage);

  setTimeout(() => { placeIndicator(active); fixStageHeight(); }, 250);
  setTimeout(() => { placeIndicator(active); fixStageHeight(); }, 800);
}
})();
</script>
